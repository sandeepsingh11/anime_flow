var flowchart,xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status?(flowchart_obj=JSON.parse(this.responseText),flowchart=flowchart_obj.flowchart,startFlowchart()):flowchart=null},xmlhttp.open("GET","../flowchart_mapping.json",!0),xmlhttp.send();var winHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;window.addEventListener("scroll",(function(){var e=document.body.scrollTop||document.documentElement.scrollTop,t=document.getElementById("flowchart-back-container");t.style.display=e+50>=winHeight?"none":"block"}));var questionsChosen_arr=[],flowchartQuestionEle=document.getElementById("flowchart-question"),flowchartChoicesContainerEle=document.getElementById("flowchart-choices-container"),flowchartBackEle=document.getElementById("flowchart-back-container");function startFlowchart(){createNodes(flowchart[0],"q")}function createNodes(e,t){if(flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);if(flowchartQuestionEle.innerHTML="q"===t?e.ques:"here are the results","q"===t)for(var a=0;a<e.tails.length;a++){(r=document.createElement("span")).setAttribute("class","button flowchart-button"),r.setAttribute("data-choice-index",e.tails[a].tail);var n=document.createTextNode(e.tails[a].ans);r.appendChild(n),r.addEventListener("click",(function(t){var a=t.target.dataset.choiceIndex;questionsChosen_arr.push(e.head);var n=getNextNode(a);createNodes(n,n.type)})),flowchartChoicesContainerEle.appendChild(r),o(r)}else for(a=0;a<e.tails.length;a++){var r;(r=document.createElement("span")).setAttribute("class","button flowchart-button"),r.setAttribute("data-answer-title",e.tails[a]);n=document.createTextNode(e.tails[a]);r.appendChild(n),r.addEventListener("click",(function(t){var a=t.target.dataset.answerTitle;questionsChosen_arr.push(e.head),createResult(a)})),flowchartChoicesContainerEle.appendChild(r),o(r)}function o(e){var t=0,a=setInterval((()=>{1==e.style.opacity?clearInterval(a):(t+=.02,e.style.opacity=t)}),10)}}function createResult(e){if(flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);jikanGetAnime(e),flowchartQuestionEle.innerHTML=e}function getNextNode(e){for(var t=0;t<flowchart.length;t++)if(flowchart[t].head==e)return flowchart[t];return-1}function jikanGetAnime(e){var t=document.createElement("div");t.setAttribute("class","spinner"),flowchartChoicesContainerEle.append(t),fetch(`https://api.jikan.moe/v4/anime?q=${e}&limit=3`).then((function(e){return e.json()})).then((function(t){if(flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);for(var a=0;a<t.data.length;a++){var n=document.createElement("div");n.setAttribute("class","anime");var r=document.createElement("a");r.setAttribute("href",t.data[a].url),r.setAttribute("target","_blank"),r.setAttribute("rel","noopener noreferrer"),r.setAttribute("class","anime-link");var o=document.createElement("img");o.setAttribute("src",t.data[a].images.jpg.image_url),o.setAttribute("alt",`image of ${e}`),o.setAttribute("class","anime-image"),r.appendChild(o);var i=document.createElement("a");i.setAttribute("href",t.data[a].url),i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("class","anime-link");var l=document.createElement("p");l.setAttribute("class","anime-title");var c=document.createTextNode(t.data[a].title);l.appendChild(c),i.appendChild(l),n.appendChild(r),n.appendChild(i),flowchartChoicesContainerEle.append(n)}}))}flowchartBackEle.addEventListener("click",(function(){var e=questionsChosen_arr.pop();if(void 0!==e){var t=getNextNode(e);createNodes(t,t.type)}}));